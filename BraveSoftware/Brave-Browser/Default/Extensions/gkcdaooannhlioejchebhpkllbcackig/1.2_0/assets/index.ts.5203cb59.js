import{s as m}from"./storage.013c1453.js";let r=!1;chrome.runtime.onInstalled.addListener(()=>{m.get().then(console.log)});chrome.tabs.onUpdated.addListener(async(e,a,t)=>{if(a.status==="complete"&&/^http/.test(t.url)&&(/https:\/\/chat.openai.com/.test(t.url)||/https:\/\/promptstorm.app/.test(t.url))){const s=await g();m.set({promptstormSessionId:s}),s?(console.log("promptstormSessionId",s),r||(console.log("addlistenerAdded: "+r),chrome.runtime.onMessage.addListener(async function(o,p,l){if(r=!0,o.type==="addHistory"){console.log("addHistory Queried: "+JSON.stringify(o));const n=await chrome.storage.local.get("lastRunDate");n.lastRunDate===void 0?(console.log("addHistory to DB: "+JSON.stringify(o)),await d(s,o.message.prompt_id,o.message.prompt,o.message.choices),await chrome.storage.local.set({lastRunDate:Date.now()})):Date.now()-n.lastRunDate>3e3&&(console.log("addHistory to DB: "+JSON.stringify(o)),await d(s,o.message.prompt_id,o.message.prompt,o.message.choices),await chrome.storage.local.set({lastRunDate:Date.now()}))}}))):console.log("not logged in")}});async function g(){return new Promise((e,a)=>{chrome.cookies.get({url:"https://promptstorm.app",name:"promptStorm_session_id"},function(t){chrome.storage.local.set({promptStorm_session_id:t==null?void 0:t.value.toString()}),t!=null&&t.value?e(t.value.toString()):e("")})})}async function d(e,a,t,s){return new Promise(async(o,p)=>{if(console.log("addHistory: "+e+a,t,s),e!==void 0){let l=JSON.stringify({promptstormSessionId:e,prompt_id:a,prompt:t,choices:s});await fetch("https://promptstorm.app/api/history/add",{method:"POST",headers:{"Content-Type":"application/json"},body:l}).then(function(i){i.status!==200?(console.log("Looks like there was a problem. Status Code: "+i.status),console.log("response: "+JSON.stringify(i)),o(!1)):(console.log("history added to promptstorm"),o(!0))})}else console.log("no promptstorm session id, you need to login to promptstorm.app first"),o(!1)})}
